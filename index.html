<script src = "fitnessFunctionList.js"></script>
<script src = "dsaPhases.js"></script>

<html>
	<meta charset="utf-8">
    <body>
		<canvas id="canvas"  style="border:1px solid #000000;"></canvas>
		<canvas id="canvasy"  style="border:1px solid #000000;"></canvas></br>
		<canvas id="canvasx"  style="border:1px solid #000000;"></canvas>
		<input type="text" id="dolphinsText">
		<input type="button" value="SearchPhase" onclick="searchPhase()">
        <script type="text/javascript">
		
			//vars
			dolphinNumbers = 3;
			//fitnessFunction = x(:,1).^2+x(:,2).^2;
			dimensionalSpaceMax = [5,5];
			dimensionalSpaceMin = [-5,-5];
			iteration = 20;
			mDirection = 3;
			speed = 1;
			time = 3;
			maxFitnessValue =0;
			maximumSearchTime = 1;
		</script>
		<script>


			var canvasx = document.getElementById('canvasx');
			canvasx.width = 400;
			canvasx.height = 20;
			var canvasy = document.getElementById('canvasy');
			canvasy.width = 20;
			canvasy.height = 400;
            var canvas = document.getElementById('canvas');
            canvas.width = 400;
            canvas.height = 400;
            var ctxx = canvasx.getContext('2d');
			var ctxy = canvasy.getContext('2d');
			var ctx = canvas.getContext('2d');
			ctx.ruler = function (dimMax, dimMin, pos) {
				diff = dimMax[0]-dimMin[0];
				div = diff/10;
				if(pos=="x"){
					actual=dimMin[0];
					for(i=0; i<10; i++){
						ctxx.font = "15px Arial";
						ctxx.fillText(actual,40*i,15);
						ctxx.moveTo(40*i,0);
						ctxx.lineTo(40*i,40);
						ctxx.stroke();
						actual = actual+div;
					}
				}else{
					actual=dimMin[0];
					for(i=0; i<10; i++){
						ctxy.font = "15px Arial";
						ctxy.fillText(actual*-1,5,40*i);
						ctxy.moveTo(0,40*i);
						ctxy.lineTo(40,40*i);
						ctxy.stroke();
						actual = actual+div;
					}
				}
				
			};
			ctx.ruler(dimensionalSpaceMax, dimensionalSpaceMin, "x");
			ctx.ruler(dimensionalSpaceMax, dimensionalSpaceMin, "y");
			ctx.setDolphins = function(dolphins){
				diff = dimensionalSpaceMax[0]-dimensionalSpaceMin[0];
				div = (diff/10)*40;
				
				for(i=0; i<dolphins.length; i++){
					ctx.beginPath();
					console.log(dolphins[i].individual);
					document.getElementById("dolphinsText").value=document.getElementById("dolphinsText").value+", "+dolphins[i].individual;
					ctx.arc(((dolphins[i].dolp[0])*div)+200,(((dolphins[i].dolp[1]*div))*-1)+200,5,0,2*Math.PI);
					ctx.stroke();
					
				}
				
			};
			
			ctx.setK = function(dolK){
				diff = dimensionalSpaceMax[0]-dimensionalSpaceMin[0];
				div = (diff/10)*40;
				
				for(i=0; i<dolK.length; i++){
					for(j=0; j<dolK[i].M.length; j++){
						for(k=0; k<dolK[i].M[j].length; k++){
							console.log(dolK[i].M[j][k]);
							ctx.beginPath();
							console.log(dolphins[i].individual);
							document.getElementById("dolphinsText").value=document.getElementById("dolphinsText").value+", "+dolphins[i].individual;
							ctx.arc(((dolK[i].M[j][k][0])*div)+200,(((dolK[i].M[j][k][1]*div))*-1)+200,2,0,2*Math.PI);
							ctx.stroke();
						}
					}
					
					
				}
				
			};
			
            ctx.Clear = function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            };
            ctx.Clear();
    
		</script>
		<script>


			
			function createDolphins(dolphinNo){
				if(dimensionalSpaceMax.length!=dimensionalSpaceMin.length){
					alert("Dimensions not match");
					return 0;
				}
			
				
				dolphins = [];
				Dolphin = {dolp:[], individual:[], neighborhood:[]};
				dolp = Dolphin;
				dolpDim = 0;
				dd = 0;//distance
		
				//creating dolphins
				for(x = 0; x < dolphinNo; x++){
					dolp = {dolp:[], individual:[], neighborhood:[]
				};

				for(y = 0; y < dimensionalSpaceMin.length; y++){
					//creating dimensions for dolphin
					dolp.dolp.push((Math.random() * dimensionalSpaceMax[0]) + dimensionalSpaceMin[0]);
				}

				//creatingIndividualOptimalSolution
				dolp.individual.push(fitnessFunction(dolp.dolp));

				//creatingNeighborhoodOptimalSolution   
				dolp.neighborhood.push(fitnessFunction(dolp.dolp));
					dolphins.push(dolp);
				}
				ctx.setDolphins(dolphins);
			}
			function searchPhase(){
				flag = true;
				iterationNow = 1;
				min = 60;
				//while(flag){
				v = [];
				newSolution = [];
				newSolutionNew = [];
				eFitness = [];
				solutionNumber = 0;
				//searchPhase();
				dolphinsDimention=[];
				directionDimention=[];
				timeDimention=[];
				solutionM={"M":[]};
				solutionT={"T":[]};
				
				
				for(d = 0; d<dolphins.length; d++){//each dolphin
					solutionM={"M":[]};
					for (i = 0; i<mDirection; i++){//sound M direction
						
						solutionT=[];
						for(j = 0; j<dimensionalSpaceMax.length; j++){
							
							for(t = 0; t<time; t++){
								
								//solutionNumber++;
								//console.log('direcciones');
								//console.log(solutionNumber);
								v[j] = speed;
								//timeDimention.push(0);
								
								solutionT.push([dolphins[d].dolp[0]+v[j],dolphins[d].dolp[1]+v[j]]);
								
								//timeDimention.push(fitnessFunction(newSolution[i,j,t][0].dolp));
								//newSolution[i, j, t] = [dolphins[d], v[j], t];
								
							}
							
						}
						
						solutionM.M[i]=solutionT;
						
					}
					
					newSolution[d]=solutionM;
					
				}
				ctx.setK(newSolution);
				//console.log(dolphins);
				/*
				for(d = 0; d<dolphins.length; d++){//each dolphin
					bestFitnessTmpValue = maxFitnessValue;
					for (i = 0; i<mDirection; i++){//sound M direction
						for(j = 0; j<dimensionalSpaceMax.length; j++){
							/*for(t = 0; t<time; t++){
								v[j] = speed;
								fit = fitnessFunction(0);
								
								//fit = fitnessFunction(newSolution[i,j,t][0].dolp);
								if(fit<bestFitnessTmpValue){
									bestFitnessTmpValue = fit;
								}
							}
						}
					}
					eFitness.push(bestFitnessTmpValue);
				}
				console.log("el menor es");
				console.log(eFitness);
				*/
				if(iterationNow == iteration){
					flag = false;
				}
				iterationNow++;
			//}
			//console.log(dolphins);
			
			}

			function dsa(){
				createDolphins(dolphinNumbers);
				//searchPhase();
			}
			

			dsa();





</script>
</body>

<html>